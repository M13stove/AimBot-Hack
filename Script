local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "ESP & Spectate Hack",
   Icon = 0, -- No icon
   LoadingTitle = "ESP & Spectate",
   LoadingSubtitle = "by Kanshy_OIO",
   Theme = "Default",
   DisableRayfieldPrompts = false,
   DisableBuildWarnings = true,

   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "ESP_Wallhack"
   },

   Discord = {
      Enabled = false,
      Invite = "noinvitelink",
      RememberJoins = true
   },

   KeySystem = false
})

local MainTab = Window:CreateTab("ESP Controls", nil)
local MainSection = MainTab:CreateSection("ESP Settings")

-- Variables
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local ESPEnabled = false
local ESPParts = {} -- Table to hold ESP parts
local WallhackEnabled = false

-- Function to draw a box around a player
local function drawESPBox(player)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local rootPart = player.Character.HumanoidRootPart
        local box = Instance.new("BoxHandleAdornment")
        box.Size = player.Character.HumanoidRootPart.Size * 1.1 -- Slightly larger to fit the character
        box.CFrame = rootPart.CFrame
        box.Adornee = rootPart
        box.Color3 = Color3.fromRGB(255, 0, 0) -- Red color
        box.Transparency = 0.5
        box.Visible = true
        box.Parent = workspace.CurrentCamera

        table.insert(ESPParts, box)
    end
end

-- Function to remove all ESP boxes
local function removeESP()
    for _, part in pairs(ESPParts) do
        part:Destroy()
    end
    ESPParts = {}
end

-- Toggle ESP button
MainTab:CreateButton({
   Name = "Toggle ESP üü•",
   Callback = function()
      ESPEnabled = not ESPEnabled
      if ESPEnabled then
         for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                drawESPBox(player)
            end
         end
      else
         removeESP()
      end
   end,
})

-- Toggle Wallhack button (see through walls)
MainTab:CreateButton({
   Name = "Toggle Wallhack üëÅÔ∏è",
   Callback = function()
      WallhackEnabled = not WallhackEnabled
      if WallhackEnabled then
         for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
                -- Enable wallhack by setting transparency of body parts to 0 (fully visible)
                for _, part in pairs(player.Character:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false -- Disable collisions to see through them
                        part.Material = Enum.Material.SmoothPlastic
                        part.Transparency = 0.3 -- Make parts semi-transparent
                    end
                end
            end
         end
      else
         -- Reset transparency for all players to default
         for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                for _, part in pairs(player.Character:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = true -- Enable collisions again
                        part.Material = Enum.Material.SmoothPlastic
                        part.Transparency = 0
                    end
                end
            end
         end
      end
   end,
})

-- Continuously update ESP for players as they move
game:GetService("RunService").RenderStepped:Connect(function()
   if ESPEnabled then
      for _, player in pairs(Players:GetPlayers()) do
         if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPart = player.Character.HumanoidRootPart
            for _, part in pairs(ESPParts) do
               if part.Adornee == rootPart then
                  part.CFrame = rootPart.CFrame
               end
            end
         end
      end
   end
end)

-- Button to Destroy GUI
MainTab:CreateButton({
   Name = "Destroy GUI",
   Callback = function()
      Rayfield:Destroy()
   end,
})
